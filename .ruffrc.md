# Ruff Configuration Guide

This project uses **Ruff** as a single tool for both **linting** and **formatting**, replacing the traditional combination of Black + Flake8 + isort.

## Why Ruff?

✅ **10-100x faster** than Black and other Python linters
✅ **All-in-one tool** - linter + formatter + import sorter
✅ **Drop-in replacement** for Black (formatting is compatible)
✅ **Written in Rust** - extremely fast
✅ **Auto-fixes** most issues automatically

## Configuration

The project's Ruff configuration is in [`ruff.toml`](ruff.toml).

### Key Settings

```toml
target-version = "py312"    # Target Python 3.12+
line-length = 100           # Maximum line length
fix = true                  # Auto-fix by default
```

### Enabled Rules

- **E, W** - pycodestyle (style errors and warnings)
- **F** - Pyflakes (detect errors)
- **I** - isort (import sorting)
- **N** - pep8-naming (naming conventions)
- **UP** - pyupgrade (modern Python syntax)
- **B** - flake8-bugbear (common bugs)
- **C4** - flake8-comprehensions (better comprehensions)
- **SIM** - flake8-simplify (simplifications)
- **RUF** - Ruff-specific rules

## Usage

### Formatting

```bash
# Format all Python files
make format

# Check formatting without changing files
make check-format

# Or use ruff directly
uv run ruff format .
uv run ruff format --check .
```

### Linting

```bash
# Check for issues
make lint

# Check and auto-fix issues
make lint-fix

# Or use ruff directly
uv run ruff check .
uv run ruff check --fix .
```

### Combined Quality Check

```bash
# Run lint-fix + format + tests
make quality
```

### Pre-commit Check

```bash
# Run all checks before committing
make check
```

## What Ruff Does

### Linting Examples

**Detects unused imports:**
```python
import os  # ❌ Ruff: F401 'os' imported but unused
import streamlit as st

def main():
    st.title("App")
```

**Detects unused variables:**
```python
def process(data):
    result = transform(data)  # ❌ Ruff: F841 Local variable 'result' is assigned to but never used
    return data
```

**Suggests modern Python syntax:**
```python
# Before
data = dict()

# After Ruff UP018 suggests
data = {}
```

### Formatting Examples

**Fixes line length:**
```python
# Before
very_long_variable_name = some_function(arg1, arg2, arg3, arg4, arg5, arg6, arg7)

# After
very_long_variable_name = some_function(
    arg1, arg2, arg3, arg4, arg5, arg6, arg7
)
```

**Organizes imports:**
```python
# Before
from langchain_core.messages import HumanMessage
import streamlit as st
from unittest.mock import Mock

# After
import streamlit as st
from unittest.mock import Mock

from langchain_core.messages import HumanMessage
```

**Standardizes quotes:**
```python
# Before
message = 'Hello'
name = "World"

# After (using double quotes)
message = "Hello"
name = "World"
```

## IDE Integration

### VS Code

Install the Ruff extension:
```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "charliermarsh.ruff",
  "[python]": {
    "editor.defaultFormatter": "charliermarsh.ruff",
    "editor.codeActionsOnSave": {
      "source.fixAll.ruff": true,
      "source.organizeImports.ruff": true
    }
  }
}
```

### PyCharm

1. Install Ruff plugin from marketplace
2. Enable "Ruff" in Settings → Tools → Ruff
3. Enable "Reformat code" on save

## Comparison with Black

Ruff's formatter is designed to be a **drop-in replacement** for Black:

| Feature | Black | Ruff Format |
|---------|-------|-------------|
| Speed | 1x | 10-100x |
| Output | ✓ | ✓ (identical) |
| Config | pyproject.toml | ruff.toml |
| Line length | 88 (default) | 88 (default) |

**Migration from Black is seamless** - Ruff produces the same formatted output!

## Performance

On this project:
```
Black:  ~200ms
Ruff:   ~20ms   (10x faster)
```

For larger projects, Ruff can be 100x faster!

## Common Commands

```bash
# Quick checks during development
uv run ruff check .                    # Fast lint check
uv run ruff check --fix .              # Auto-fix issues
uv run ruff format .                   # Format code

# Detailed output
uv run ruff check --output-format=full

# Check specific files
uv run ruff check main.py test_main.py

# Ignore specific rules for a line
result = some_code()  # noqa: RUF001

# Ignore specific rules for a file
# ruff: noqa: E501
```

## CI/CD Integration

In GitHub Actions or other CI:

```yaml
- name: Lint with Ruff
  run: |
    uv run ruff check .
    uv run ruff format --check .
```

Or simply:
```yaml
- name: Quality Check
  run: make check
```

## Resources

- [Ruff Documentation](https://docs.astral.sh/ruff/)
- [Ruff Rules](https://docs.astral.sh/ruff/rules/)
- [Ruff vs Black](https://docs.astral.sh/ruff/formatter/#black-compatibility)
- [Ruff GitHub](https://github.com/astral-sh/ruff)
